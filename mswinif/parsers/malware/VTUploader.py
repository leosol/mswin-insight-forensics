import os
import logging
from mswinif.parsers.GenericParser import GenericParser
from mswinif import fs_utils
import pyscca

FILE_EXTENSIONS = "exe,apk"

class VTUploader(GenericParser):

    def __init__(self, upload_regex=FILE_EXTENSIONS):
        self.logger = logging.getLogger(self.__class__.__name__)
        super().__init__(name="vt_uploader")
        vt_keys_value = os.getenv("VIRUS_TOTAL_API_KEY")
        if vt_keys_value is not None:
            self.vt_keys = vt_keys_value.replace(';', ',').split(',')
        else:
            self.vt_keys = None
            self.logger.warning(f"No VirusTotal API key set. VTUploader is disabled")
        if upload_regex is None:
            self.logger.warning(f"No VirusTotal API key set. VTUploader is disabled")
        else:
            extensions = upload_regex.replace('.', '').replace(';', ',').split(',')
            self.file_patterns = []
            for ext in extensions:
                self.file_patterns.append(f".*\\.{ext}$")